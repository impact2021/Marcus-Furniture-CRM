name: Deploy WordPress Plugin

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy Plugin to FTP
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout repository files
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Deploy plugin using FTP
      - name: Sync files
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          protocol: ftps
          port: 21
          local-dir: ./  # Sync all files
          server-dir: ${{ secrets.FTP_PATH }}/wp-content/plugins/your-plugin-folder/

      # 3. Verify deployment success (Check Plugin Status)
      - name: Verify Plugin Deployment
        run: |
          # URL to check if the plugin is active (adjust as needed)
          PLUGIN_API="https://yourdomain.com/wp-json/wp/v2/plugins/your-plugin-slug/status"

          # Perform HTTP request and verify success (status 200)
          HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" "$PLUGIN_API")
          if [ "$HTTP_STATUS" -ne 200 ]; then
            echo "Plugin validation failed! Expected HTTP 200 but got $HTTP_STATUS."
            exit 1
          else
            echo "Plugin successfully verified!"
          fi
